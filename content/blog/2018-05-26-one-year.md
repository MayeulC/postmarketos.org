title: "One Year of postmarketOS: Mainline Calling!"
date:  2018-05-26
---

(TODO: mention that this is not the exact date, but we decided to polish this post before rushing out something unfinished.)

[TOC]

## Mainline On the Horizon
[![](/static/img/2018-05/forward-porting-elec-2017-thumb.jpg){: class="fr ml3 mb4"}](https://www.youtube.com/watch?v=77tuFtM4gjA)

[![](/static/img/2018-05/pixelated-logo-thumb.jpg){: class="fr ml3 cr mb4"}](/static/img/2018-05/pixelated-logo.jpg)

[![](/static/img/2018-05/keynote-linaro-connect-2018-thumb.jpg){: class="fr ml3 cr"}](https://www.youtube.com/watch?v=lMh4ZmR59hQ)

In February 2017 Jeremy McNicoll did a presentation on his progress on [forward porting Google Nexus 5X/6P](https://www.youtube.com/watch?v=77tuFtM4gjA). He explains the technical difficulties of replacing the downstream Linux kernel that you find on your device after you bought it with the latest [upstream version](https://www.kernel.org/). Towards the end, he comments his "lessons learned" slide with the words: "Maybe 10 years ago I would have said we can cure world hunger, we can get the whole thing working." Then he shaked his head. "I'm more realistic now."

This is how it felt like one and a half years ago. It was hard to imagine that we could have phones that would run the upstream kernel. Which means that every time the vendor's ridiculously short support cycle ends, we would not have a feasible method of patching all the critical security holes in the core of the operating system.

Don't get your hopes up too high, there is still a long way to go. But after all the amazing work done by hackers in communities like ##linux-msm and #freedreno, this is getting realistic now. Besides the progress in postmarketOS, this goal is being adapted by more projects. Two more distributions decided to make mainline Linux on (specific) phones their mission: [Pure OS](https://puri.sm/shop/librem-5/) and [Maemo Leste](https://maemo-leste.github.io/).

Even established vendors seem to be moving in this direction. In March of this year, the [Linaro Connect Opening Keynote](https://www.youtube.com/watch?v=lMh4ZmR59hQ) had 15 minutes of convincing its big list of [member companies](https://www.linaro.org/members/) that mainline is the way to go: "Very few embedded SoCs are supported properly upstream. That is changing, it has to change. [...] and most importantly, we have to do that upstream. Because nothing else scales. Testing just your own version doesn't actually help everyone else. And as a result you don't get the benefit of everybody else's testing."

## postmarketOS: Experimental Sustainable Operating System
[![](/static/img/2018-05/fbdebug-smte-bars-wrong-thumb.png){: class="fr ml3 mb4"}](/static/img/2018-05/fbdebug-smte-bars-wrong.jpg)

Before we begin with our list of changes since the last post in [December](/blog/2017/12/31/219-days-of-postmarketOS/), here's the usual summary for people new to the project: postmarketOS aims to be a sustainable operating system that empowers users to safely use their devices until they physically break. We divide the system into packages and share them between all devices, with a few device-specific packages as exception. In contrary to having the whole system built device specific (like Android), this makes the system much more maintainable.

At this point, postmarketOS is only meant to be used by developers. In most instances, phone calls, SMS, bluetooth or the mainline kernel won't work on your device, and there's the [firmware problem](https://ollieparanoid.github.io/post/security-warning/).

## Nexus 5: FLOSS Modem Stack With Mainline
[![](/static/img/2018-05/mainline-hammerhead-plamo-firefox-thumb.png){: class="fr ml3 cr"}](/static/img/2018-05/mainline-hammerhead-plamo-firefox.jpg)

You might remember [@bshah](https://github.com/bhush9)'s  photo of the [Nexus 5](https://wiki.postmarketos.org/wiki/Google_Nexus_5_(lg-hammerhead)) running mainline with a [flipped and distorted screen](/static/img/2017-12/mainline-hammerhead.jpg) from December. [@flto](https://github.com/flto) [continued](https://github.com/flto/linux/wiki/hammerhead-upstream) his work: the display works without problems now. Even better, the touch screen is working, it has 3D acceleration with the open source [freedreno](https://github.com/freedreno/freedreno/wiki) userspace driver, Wi-Fi works, and the best part is that [@MartijnBraam](https://github.com/MartijnBraam) was able to send SMS and initialize a call via command line as well as getting the connectivity signal from the modem through [oFono](https://en.wikipedia.org/wiki/oFono) displayed in [Plasma Mobile](https://plasma-mobile.org/) ([#1502](https://github.com/postmarketOS/pmbootstrap/pull/1502)). All of that without proprietary userspace blobs!

Of course it would be nice if one could accept the call and actually talk to the other end. We're not quite there yet, but thanks to Srinivas Kandagatla who is working on mainline audio support for the [Snapdragon 820E SoC](https://en.wikipedia.org/wiki/List_of_Qualcomm_Snapdragon_devices#Snapdragon_820_and_821), the Linux kernel will soon be able to utilize the audio stack on Qualcomm phones like the Nexus 5. Then we can puzzle the userspace functionallity together.

So right now we can communicate with the Qualcomm Modem Interface (QMI) without using any userspace blobs. This would not have been possible without the amazing work from [@scintill](https://github.com/scintill) who packaged all necessary glue libraries provided by [@andersson](https://github.com/andersson) ([#1314](https://github.com/postmarketOS/pmbootstrap/pull/1314)). The first pull request made it work with the downstream kernel of the [Galaxy S4 Mini LTE](https://wiki.postmarketos.org/wiki/Samsung_Galaxy_S4_Mini_LTE) followed by another PR that enabled it to work with our mainline packaging ([#1381](https://github.com/postmarketOS/pmbootstrap/pull/1381)).

[![](/static/img/2018-05/mainline-hammerhead-terminal-kernel-thumb.jpg){: class="fl mr3"}](/static/img/2018-05/mainline-hammerhead-terminal-kernel.jpg)
[![](/static/img/2018-05/mainline-hammerhead-plamo-modem-thumb.jpg){: class="fl mr3"}](/static/img/2018-05/mainline-hammerhead-plamo-modem.jpg)
[![](/static/img/2018-05/mainline-hammerhead-call-from-terminal-thumb.jpg){: class="fl mr3"}](/static/img/2018-05/mainline-hammerhead-call-from-terminal.jpg)

<div class="cf"></div>

*Thanks to: [@andersson](https://github.com/andersson), [@bshah](https://github.com/bhush9), [@flto](https://github.com/flto), [@MartijnBraam](https://github.com/MartijnBraam), [@opendata26](https://github.com/opendata26), [@scintill](https://github.com/scintill)*

## linux-postmarketos-qcom
As we are running bleeding edge technology here, we need to use kernel patches that did not make their way into the mainline kernel yet. These patches are tiny in size, and the patch authors are trying to upstream them (in contrary to kernels from Android with vendor patches in the order of a hundred thousand up to one million lines of changes, as the Linaro keynote mentions). We decided to set up a staging repository [`linux-postmarketos`](https://github.com/postmarketOS/linux-postmarketos) for easy collaboration, and packaging the Qualcomm specific branch from there in a new package `linux-postmarketos-qcom`. With the separate package, the patches won't break anything for non-Qualcomm devices that use an upstream kernel in postmarketOS.

Two more devices besides the Nexus 5 are using `linux-postmarketos-qcom` already. The [Sony Xperia Z2](https://wiki.postmarketos.org/wiki/Sony_Xperia_Z2_(sony-sirius)) (not to be confused with the [tablet](https://wiki.postmarketos.org/wiki/Sony_Xperia_Z2_Tablet_(sony-castor-windy))) ported by [@opendata26](https://github.com/opendata26) has battery capacity, temperature sensors, Wi-Fi and the display with 3D accelleration working! More great news: in theory one would need a closed source component to communicate with the cellular modem, but kernel hacker and Sony employee @bamse confirmed that he can soon release that as open source!

The third device is the [Samsung Galaxy S5](https://wiki.postmarketos.org/wiki/Samsung_Galaxy_S5_(samsung-klte)) contributed by [@drebrez](https://github.com/drebrez). It is in an early porting stage, but so far the debug serial interface, volume buttons and internal storage access are working with that kernel. If you want to use the display with postmarketOS, you need to use the downstream kernel (which is packaged as well). Nowadays you can choose the kernel during the installation ([#1363](https://github.com/postmarketOS/pmbootstrap/pull/1363)).

(TODO: add pictures of those devices)

## Raspberry Pi, Samsung Galaxy Tab 10.1 and Nokia N9
[![](/static/img/2018-05/raspberry-pi-tv-thumb.png){: class="fr ml3 cr"}](/static/img/2018-05/raspberry-pi-tv.jpg)

Besides Qualcomm devices, we have a hand full of additional new ports running close to mainline. [@drebrez](https://github.com/drebrez) tweaked pmOS to run on all Raspberry Pi models up to 3A, building on the [existing support in Alpine](https://wiki.alpinelinux.org/wiki/Raspberry_Pi) ([#1501](https://github.com/postmarketOS/pmbootstrap/pull/1501)). [@yangxuan8282](https://github.com/yangxuan8282) did a lot of testing and took this photo of XFCE4 running on a small touch screen directly on the Pi.

Next up is the Tegra based [Samsung Galaxy Tab 10.1](https://wiki.postmarketos.org/wiki/Samsung_Galaxy_Tab_10.1%22_(samsung-p4wifi)) with an amazing feature list containing Wi-Fi, 2D acceleration, VDPAU h264 hardware decoding, headphone and speaker audio as well as bluetooth! [@Decatf](https://github.com/Decatf) added the device in [#1279](https://github.com/postmarketOS/pmbootstrap/pull/1279).

Finally the Nokia N9 work of [@filippz](https://github.com/filippz) and [@pavelmachek](https://github.com/pavelmachek) which we introduced in the [last post]() has been merged into the `master` branch ([#1101](https://github.com/postmarketOS/pmbootstrap/pull/1101)). [@pavelmachek](https://github.com/pavelmachek) [explained](https://github.com/postmarketOS/pmbootstrap/pull/1046#issuecomment-354362721) why the N9 and all other devices listed in this section have their own kernel packages instead of using `linux-postmarketos-stable` (like the [Nokia N900](#100dayspost)): "We'll need quite a few patches for now, and it would be bad to break some other phone with patches relevant for N9. Long-term it is a goal, and we are not that far, but I don't think we should do it now."

<div class="cf"></div>

## Initramfs: Charging and Maximum Attention
postmarketOS is able to show a nice battery loading screen while it is "turned off" and charging, because [@drebrez](https://github.com/postmarketOS/pmbootstrap/issues/1081) integrated [`charging-sdl`](https://github.com/postmarketOS/charging-sdl) into the [initramfs](https://en.wikipedia.org/wiki/Initial_ramdisk) ([#1081](https://github.com/postmarketOS/pmbootstrap/issues/1081)).

When [porting pmOS to a new device](https://wiki.postmarketos.org/wiki/Porting_to_a_new_device), it may happen that the device doesn't do anything on first boot. The screen stays dark (or displays the OEM logo) and the USB networking does not come up. In this case we don't even know for sure if the kernel we just tested is booting at all, or if it crashed before even executing the initramfs code. But this information is crucial in order to use the right [troubleshooting techniques](https://wiki.postmarketos.org/wiki/Troubleshooting:boot). Thanks to [@MayeulC](https://github.com/MayeulC) we can install the `maximum-attention` initramfs hook now, which will flash every LED it can find, as well as running the vibration motor ([#1238](https://github.com/postmarketOS/pmbootstrap/pull/1238)). Be prepared to see your device wandering across the table!

## New UIs

(TODO: list existing UIs)

### i3wm
Tiling window managers like [i3](https://i3wm.org/) make as much use of the screen space as possible. If you have one window open, it is always full screen, two windows split the screen in half and so on. When thinking about this, that is not so different from what today's mainstream smartphone user interfaces do. The similarities end in the fact that you can use the touch screen to manage your windows, while on a tiling WM you would use the keyboard.

We have found two ways to use i3 on a mobile device. One is obviously devices with a keyboard, like the Nokia N900. Since i3 is about as resource lightweight as you can get, it is a pretty good match for that classic machine and a few people are using it!

The other is extending i3 with touch controls. [@michitux](https://github.com/michitux) has been working on integrating [i3touchmenu](https://github.com/ssmolkin1/i3touchmenu/) ...

### Matchbox

## Libhybris
* mention gemini?

## 39 New Devices (80 Total)

## Improved Continuous Integration
Whenever someone got their new device port to a point where it boots, the porting guide recommends to make a pull request and upstream it (so everyone can benefit from the work that has been done and build upon it). In order to keep the reviewing efforts as low as possible, [@ollieparanoid](https://github.com/ollieparanoid) implemented the following new CI checks:

* All devices must be [documented in the wiki](https://wiki.postmarketos.org/wiki/Devices) ([#1369](https://github.com/postmarketOS/pmbootstrap/pull/1369))
* All changed packages must build ([#982](https://github.com/postmarketOS/pmbootstrap/pull/982))

[#982](https://github.com/postmarketOS/pmbootstrap/pull/982) also has a new test case that instructs `pmbootstrap` to do two full installations (one of them with XFCE4, the other one with Plasma Mobile). Both installations will then run in QEMU, and the test case will connect via SSH to the VM to verify the running processes. More than once this saved us from introducing bugs by accident in the installation code.

## pmbotstrap

### init

## #postmarketOS-lowlevel Progress

## (awesome community)

* akademy 2018

## Raw Numbers

![Graph of the number of devices in the repository over time](/static/img/2018-05/devices-over-time.svg)

## Get Involved
### Mainline Your Device!
* new mainline guide!
* envkernel.sh


### Other Ways to Help Out
* anbox (describe current progress, add screenshot of the loading screen)
* openiboot
* blogging
* review PRs
* figure out problems in the issues
* ...
